<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Upload and Display</title>

    <style>
        .imger{
          width:90%;
          height:auto;
        }
    </style>
</head>

<body>
    <h1>上传孩子照片，立即生成新年图片（StableDiffusion）</h1>
    <label>性别:</label>
    <input type="radio" id="male" name="gender" value="1" checked>
    <label for="male">男</label>
    <input type="radio" id="female" name="gender" value="0">
    <label for="female">女</label>
    </br>
    <input type="file" id="imageUpload" accept="image/*">
    <div id="response"></div>
    <img id="img1" src="" class="imger">
    <p>当您上传了图片，绘制好的图片大约10-20秒将会在这里显示。</br>AI画图需要时间，无法立即显示图片为正常情况，请耐心等待。如果很久都没有反应，请再换一张试试或者反馈至开发者。</br></p></img>

    <script>
        let base64String;
        document.getElementById('imageUpload').addEventListener('change',async function(event) {
            const file = event.target.files[0];
             if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    // 将Base64编码字符串保存到全局变量
                    base64String = e.target.result;
                    console.log("Base64 Encoded String: ", base64String);
                    
                    // 现在可以在其他地方使用base64String变量
                    doSomethingWithBase64String(base64String);
                };
                reader.readAsDataURL(file);
            }
        });
        function doSomethingWithBase64String(bs)
        {
          
        item = $('input[name=gender]:checked').val();
          let imageObject = {
          "img_base64": bs,
            "ismale":item
        };
        
        var imgElement = document.getElementById('img1');
        // 将对象转换为JSON字符串
        let jsonString = JSON.stringify(imageObject);
          fetch('http://localhost:18888/process_image', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: jsonString
        })
        .then(response => response.json())
        .then(data => {console.log('information:', data.result[0]);imgElement.src = "data:image/png;base64,"+data.result[0];})
        .catch((error) => console.error('Error:', error));
        
        
        }
    </script>
</body>

</html>